# PyPIサーバー設定する

## PyPIサーバー設定する

OMFLOWプロセスのコードコンポーネントはPythonコードを実行できます。ユーザーは、インターネットやコミュニティで便利なサンプルプログラムやパッケージを見つけて、独自のプロセスを構築できます。このとき、pythonパッケージを別途インストールする必要がありますので、pythonパッケージのインストール方法を説明します。

サーバーに外部ネットワークがある場合、パッケージのインストールはOMFLOWを介して直接行うことができ、ユーザーはプロセスでpythonコンポーネントのパッケージタブを確認するだけで済みます。(詳細については、【**アプリ管理>コンポーネントの概要**】を参照してください)。インストールする必要のあるパッケージの名前を入力すると、システムは、シェルフプロセス中にパッケージがインストールされているかどうかを確認します。インストールされていない場合、ユーザーのパッケージは自動的にインストールされます。

サーバーに外部ネットワークがない場合、ユーザーはこの時点でサーバーセットアップする必要があります。以下では、PyPIサーバー作成する方法について説明します。

### サーバーを設定する

基本的な要件：python、pip

サーバー設定する最も基本的な方法は、Pythonを環境にインストールすることです。Pythonのインストール方法、環境変数の設定などについては、Pythonの公式ウェブサイトにアクセスして参照してください。ここでは説明を割愛します。

**STEP1、キットをインストールします**

サーバー環境に外部ネットワークがある場合は、コマンドプロンプトを開き、次のコマンドを入力します。

```
pip install devpi-server
pip install devpi-client
```

外部ネットワークがない場合は、外部ネットワークのある環境でパッケージを入手してください。Googleでdevpiを直接検索して、パッケージをダウンロードできます。

```
https://pypi.org/project/devpi-server/#files  
https://pypi.org/project/devpi-client/#files
```

> 事前に.whlファイルをダウンロードしてください。

または、pythonコマンドを使用してダウンロードします。コマンドは、次のとおりです。

```
pip download devpi-server -d <ダウンロードパス>
pip download devpi-client -d <ダウンロードパス>
```

次に、ダウンロードしたwhlファイルをサーバー環境に移動し、コマンドプロンプトを再度開いて、次のコマンドを入力します。

```
pip install <devpi-server.whlパス>
pip install <devpi-client.whlパス>
```

**STEP2、devpiサーバーを初期化します**

devpiパッケージをインストールした後、サーバーの初期設定を実行する必要があります。コマンドは次のとおりです。

```
devpi-init --serverdir="/devpi"
```

> \--serverdirの後ろにあるパスはサーバーの場所を表し、自分で調整することができます。

**STEP3、サーバーを起動します**

アカウントを作成したら、サーバーを起動できます。次のコマンドを入力します。

```
devpi-server --serverdir="/devpi" --restrict-modify=root --port=3141 --host=<IP位置>
```

> \--port=3141はデフォルト値です（変更可能）。\
> \--host=現在のセットアップ環境のIPを入力してください。

> サーバーが設定されている環境に外部ネットワークがある場合は、この手順を完了した後、4番目の手順にスキップしてください。

**STEP4、クライアントを設定します**

外部ネットワークがない場合、ユーザーはパッケージを個別にダウンロードし、最終的に統合管理のためにサーバーにアップロードします。このとき、クライアントパッケージが必要です。設定コマンドは次のとおりです。

```
#クライアントが指すサーバーの場所を設定する
devpi use http://<IPの場所>:<Port>
```

> ipとportはどちらも、手順3で設定した値です。

```
#ログインする
devpi login root --password=<パスワード>

#rootユーザーの下に独自のフォルダを作成する
devpi index -c local
```

> ローカルは変更することができます。

```
#作成したばかりのローカルフォルダに切り替る
devpi use root/local

#ダウンロードしたパッケージをPyPIサーバーにアップロードする
devpi upload --from-dir <ダウンロードしたさまざまなパッケージのwhlファイルへのパス>
```

この時点で、pypiサーバーのセットアップは完了です。

**STEP5、OMFLOWサーバーを設定します**

サーバーをセットアップした後、OMFLOW設定に移動する必要があるため、アプリケーションがシェルフに配置されると、システムはこの設定に従ってインストールパッケージをpypiサーバーにダウンロードします。

OMFLOWにログイン > システム設定 > システム設定で、「PIPServerの位置」フィールドを見つけてサーバーの場所を記入し、保存すると設定が有効になります。

> pypiサーバーが外部ネットワークを持っている場合、パス場所の記入例：\
> http://\<IP>:3141/root/pypi/+simple/

> 外部ネットワークがない場合、パス場所の記入例：\
> http://\<IP>:3141/root/local/
