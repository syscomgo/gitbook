# 應用管理

> 備註：
>
> 1. **必填**：表單欄位屬性，需填寫此欄位才能儲存或進行下一步。
> 2. **唯一值**：表單欄位屬性，此欄位值比對其他表單資料同欄位不得重複。
> 3. **值**：填寫特定欄位時用於存放資料庫，多用於系統或流程運算，且不受語言版本影響。
> 4. **字**：填寫特定欄位時用於顯示作用。
> 5. **流程變數**：流程在行進時可提供各元件取用的變數類型。
> 6. **元件變數**：僅供元件本身使用的變數類型。

### 應用設計

此處為OMFLOW的核心功能，可在此建立自訂流程並上架，以提供一般使用者或外部系統使用。

> ※ 本篇文章主要在介紹各個頁面的功能，如何從無到有的建立一個應用請參閱【建立應用及流程】章節

### 應用列表

```
位置：［主選單］＞應用管理＞應用設計
```

每個應用可視為擁有多個流程的容器，應用列表頁面功能介紹如下：

1. **新增**：新建自定義應用
2. **刪除**：刪除勾選的應用
3. **上架**：上架一個已經設計完成的應用
4. **篩選**：透過關鍵字搜尋、篩選屬性、一次顯示資料筆數
5. **還原**：將篩選還原成預設值
6. **匯入**：匯入舊有應用
7. **匯出**：將勾選的應用匯出
8. **雲端下載**：下載官方提供的雲端應用，屬於下列情況時可使用：

> • 當版本更新時需要同步下載對應的內建流程\
> • 官方釋出新的套件應用

新增應用後可在應用列表的最右側看到**設定**按鈕，點擊後可修改以下資訊：

1. **應用名稱**：修改應用名稱
2. **應用設計權限**：使該角色在不給予**應用管理權限**的情況下，能夠進行**設計**、**上架**並**設計相關服務請求**。
3. **應用參數**：設定參數提供流程取用，並可隨應用一同匯出。

> ※ 「應用設計權限」賦予「設計人員」對特定應用擁有**設計**到**上架調整**的權限。

### 流程列表

```
位置：［主選單］＞應用管理＞應用設計＞［任一應用］
```

點擊應用列表任一個應用，進入流程列表頁面，功能介紹如下：

1. **新增**：新建一個表單，可選擇「表單流程、靜態表單」，其中**表單流程**會在開單時執行設計的流程。
2. **複製**：複製勾選的流程至另一個應用
3. **刪除**：刪除一個流程
4. **篩選**：透過關鍵字搜尋、一次顯示資料筆數
5. **還原**：將篩選還原成預設值
6. **套件**：表列該應用所有流程需要的套件
7. **語言**：匯入、匯出翻譯後的語言包

> ※ 在此列表中所看到的流程後續統稱**主流程**，以便與**子流程**區別。

### 設計表單流程＞參數設定

```
位置：［主選單］＞應用管理＞應用設計＞［任一應用］＞［任一流程］＞參數設定
```

點擊**新增**按鈕或［任一流程］即可進入流程編輯頁面，首先會看到**參數設定**頁籤，以下介紹各項設定：

1. **流程名稱**：輸入文字，上架後無法更動，必填
2. **API路徑**：輸入英數字，作為資料庫的表格名稱，唯一值、必填
3. **說明**：說明該流程的作用。
4. **執行過程記錄(LOG)**：紀錄流程每個點的輸入與輸出。
5. **應用程式介面(API)**：允許該流程被其他功能、系統透過API呼叫。
6. **內部介接編輯**：允許其他流程透過「內部流程、外部流程、程式碼」元件對其進行開單、推單，參考【程式碼元件】章節。
7. **內部介接刪除**：允許其他流程透過「程式碼」元件對其進行刪單，參考【程式碼元件】章節。
8. **內部介接查詢**：允許其他流程透過「程式碼」元件對其進行查詢，參考【程式碼元件】章節。
9. **是否建立任務**：允許該流程在**我的任務**產生任務。
10. **查看目前流程及進度**：在表單頁面上啟用**流程檢視**功能，參考【Apps＞流程檢視】章節。
11. **檢視表單資料操作歷程**：在表單頁面上啟用**歷程**功能，參考【Apps＞歷程】章節。
12. **附加檔案功能**：在表單頁面啟用**附加檔案**功能，參考【Apps＞附加檔案】章節。
13. **顯示資料關聯**：在表單頁面啟用**關聯操作**功能，參考【Apps＞關聯操作】章節。
14. **填寫及顯示工作日誌**：在表單頁面啟用**工作日誌**功能，參考【Apps＞工作日誌】章節。
15. **檢視服務水準狀態**：在表單頁面啟用**服務水準**功能，參考【Apps＞服務水準】章節。
16. **顯示列印按鈕**：在表單頁面啟用**列印**功能，參考【Apps＞服務水準】章節。
17. **表單內快速操作確認視窗**：當使用者在表單內使用快速操作時，是否彈出確認視窗。

> 注意事項：\
> (1) 應用上架後，**流程名稱**將與**API路徑**綁定，如需修改僅能變更翻譯\
> (2) **API路徑**為流程的識別名稱，一旦變更則視為新的流程

#### 進階參數設定

此處可勾選**表單編號**自訂代號規則，介紹如下：

1. 文字：輸入文字，一般用於單號的開頭英文簡寫。
2. 日期：接續在**文字**後面顯示**開單時間**，範例：填入ymdHMS會顯示20240227135959，詳細可查看下方表格
3. 流水號長度：接續在**日期**後面顯示流水號並設定其長度，範例：填入5則第一張單號結尾會顯示00001
4. 流水號重置時間：設定流水號是否要設定重置週期。

| 日期符號 | 說明 | 顯示範例 |
| ---- | -- | ---- |
| y    | 年  | 2024 |
| m    | 月  | 02   |
| d    | 日  | 29   |
| H    | 時  | 23   |
| M    | 分  | 59   |
| S    | 秒  | 59   |

### 設計表單流程＞權限設定

```
位置：［主選單］＞應用管理＞應用設計＞［任一應用］＞［任一流程］＞權限設定
```

此處設定哪些角色可擁有該流程的權限，並在所屬應用上架時生效。

1. **新增**：新增一個已存在的角色，並將此流程的權限給予這個角色。
2. **刪除**：將此流程的權限從勾選的角色中移除。

新增後的角色可設定四種權限，以下介紹：

1. **檢視**：可在\*\*〔主選單〕＞Apps\*\*顯示此流程，並能檢視該流程的表單列表。
2. **新增**：可在該流程的**表單列表**頁面進行開單。
3. **更新**：表單進入人工輸入時，可推動表單進行下一步驟。
4. **刪除**：可以刪除該流程的表單。

> ※ 當應用重新上架時，會先將所有角色相關的流程權限進行刪除，再重新賦予權限。

#### 進階設定

此處可在某些特定情況下，讓具備檢視權限的使用者只能看到特定表單，勾選後可看到以下欄位：

1. **檢視所有表單**：選擇指定的部門、角色、使用者，可無視條件檢視該流程的全部資料。
2. **指定表單欄位符合使用者個人資訊時，使用者可檢視該表單**：當此表單特定欄位與使用者個人資訊相符時可檢視該表單。
3. **指定表單欄位符合特定值時，選擇部門、角色、使用者可檢視該表單**：指定表單欄位符合特定值時，特定部門、角色、使用者可檢視該表單。

> ※ 上述三種檢視規則，其每條規則都是各自成立，當使用者符合任一條規則即可看到該筆單。

## 表單設計

```
位置：［主選單］＞應用管理＞應用設計＞［任一應用］＞［任一流程］＞表單設計
```

設計欄位讓使用者填寫，並帶入流程中計算、運用，以下將進行介紹：

#### 表單設計＞區塊&半區塊

點擊 **+區塊** 及\*\*+半區塊\*\* 按鈕可新增區塊至表單中，區塊主要是負責為表單劃分位置，以下為區塊功能介紹：

1. **新增欄位〔+〕**：在區塊中新增各式欄位，詳細可參考【表單欄位介紹】章節。
2. **刪除〔X〕**：刪除區塊，並連同包含的欄位一同刪除。
3. **設定〔齒輪〕**：設定區塊屬性，以下介紹：\
   • **標題文字**：區塊的標題文字\
   • **標示顏色**：區塊上方直線的顏色\
   • **隱藏**：隱藏此區塊及內部的欄位

> ※ 必須先建立**區塊**才能新增**欄位**。

### 表單欄位介紹

以下介紹大部分欄位會有的基礎欄位：

1. **欄位名稱**：輸入文字作為欄位顯示的名稱
2. **註解說明**：欄位的說明，以placeholder的方式顯示
3. **預設值**：預設帶入欄位的值
4. **類型**：分為文字、數字、密碼、唯一值、網址、電子郵件
5. **必填**：當資料被建立或推進時會檢查必填欄位，若值為空則會拒絕操作。
6. **唯讀**：勾選後使用者對於此欄位只能看不能修改。
7. **隱藏**：隱藏此欄位

#### 表單設計＞輸入方塊

輸入文字的欄位，並可依照下列屬性進行調整：

1. **格式檢查**：輸入regex語法後，系統會依照該語法檢查內容是否符合，如不符合則拒絕使用者的操作。
2. **行動裝置上啟用相機掃描條碼**：手機專用功能，可自動輸入條碼資料。
3. **遮罩**：將欄位資料進行遮蔽，以下為遮蔽規則：
4. **開頭顯示位數**：填入數字，從第一字元到指定字元不遮蔽。
5. **結尾顯示位數**：填入數字，從最後字元往回計算到指定字元不遮蔽。
6. **遮罩最小字數**：填入數字，確保遮蔽字元數量。

#### 表單設計＞多行輸入

**行數**：該項調整通常是為了表單編排的美觀，並不會限制使用者輸入的內容長度。如果使用者打的內容超過了設定，欄位會旁邊會出現下拉捲軸。

#### 表單設計＞下拉選單

下拉選單多出了一個選項的頁籤，可以新增刪除選項。按住`**↕︎**`可以拖動選項。\
**複選**：允許選擇多個項目\
**選項排序**：勾選後，將紀錄使用者的選擇順序，範例：3,1,2\
**複選上限**：複選時可選擇的數量上限\
**複選下限**：複選時可選擇的數量下限\
**預設值**：複選的預設值請以半形逗號分隔，範例：1,2,3,4

**「選項」頁籤**

1. **值**：填入「值」，提供給系統運算使用，不會受語言版本影響。
2. **顯示文字**：填入「文字」，顯示給使用者辨別使用。

> ※ **下拉選單**欄位無論單複選在資料庫儲存格式為`[＜值＞,＜值＞,...]`

#### 表單設計＞單選/複選選單

此欄位可自訂所有選項並提供勾選，其中大部分選項與「下拉選單」相同，以下介紹其他選項：\
**其他**：當使用者沒有適合選項勾選時，可於此「其他」欄位自行填寫，該填寫會同時作為「字、值」儲存。

> ※ **單選/複選選單**欄位無論單複選在資料庫儲存格式為`[＜值＞,＜值＞,...]`

#### 表單設計＞標題

表單的固定欄位，類似於**輸入方塊**欄位：

> ※ OMFLOW許多功能會以**標題**欄位來代表此表單的名稱，如「我的任務、關聯操作」等等。

#### 表單設計＞狀態

表單的固定欄位，類似於類似於**下拉選單**：

> ※ OMFLOW許多功能會以**狀態**欄位來代表此表單的當前階段，如「我的任務、關聯操作」等等。

#### 表單設計＞燈號

表單的固定欄位，類似於**下拉選單**，但是只有紅、黃、綠燈三個固定選項。

> ※ OMFLOW許多功能會以**燈號**欄位來代表此表單的嚴重或緊急程度，如「我的任務、服務水準」等等。

#### 表單設計＞受派人及部門

表單的固定欄位，由「部門、使用者」兩種欄位組成。在選擇部門後，**使用者**欄位會動態產生該部門底下的使用者以供選擇，以下介紹設定：

**含受派人欄位**：預設為勾選，如果將此勾選清除，則該欄位只會顯示**部門**欄位。

**預設值**：可填入**＜部門ID＞,＜使用者ID＞**作為開單時的預設指派對象，ID查詢至**人員管理＞使用者管理**及**人員管理＞部門管理**查看編號「編號」欄位。

> 此欄位決定**任務**的建立及指派對象，若只選擇**部門**但未選擇**使用者**，則該部門所有使用者皆能在「我的任務＞任務列表」看到此單。

#### 表單設計＞備註1、備註2、備註3 - 1.2.1 New

表單的固定欄位，類似於**標題**欄位，當部分特殊資訊需顯示在「我的任務」時可存放於此欄位。

> ※ 我的任務預設顯示此欄位，若無需顯示此欄位時可參考【我的任務＞隱藏備註】章節進行隱藏操作。

**「選項」頁籤**

此頁籤可限制哪些部門可以被選擇。

#### 表單設計＞日期

點擊該欄位會跳出**日期**介面以供選擇。

#### 表單設計＞日期/時間

點擊該欄位會跳出**日期時間**介面以供選擇。

#### 表單設計＞子查詢

此欄位會顯示OMFLOW其他流程的表單資料之清單，使用者可勾選任一筆資料並將特定欄位回填到本表單：\
**使用者不可自行輸入**：僅開放查詢並由系統回填欄位之方式，不允許手動輸入。

以下介紹子查詢的設定步驟：

1. **表單**頁籤：選擇要查詢的應用、流程(簡稱：**被查流程**)
2. **條件**頁籤：設定條件進行初步篩選，縮小**被查流程**顯示的資料範圍
3. **動態條件**頁籤：以**使用者**及**本表單**的資料作為條件篩選，縮小**被查流程**顯示的資料範圍
4. **回填**頁籤：當使用者選定**被查流程**的資料後，將該筆資料的欄位值回填至本表單的指定欄位中

> 設定**條件、動態條件**注意事項：\
> 在「下拉選單、單選/複選選單、狀態、燈號」欄位以「值」為查詢目標。\
> 在「受派部門、部門、使用者」欄位以「ID」為查詢目標。

#### 表單設計＞外部查詢

此欄位可透過python代碼回傳資料清單，使用者可勾選任一筆資料並將特定欄位回填到本表單：\
**使用者不可自行輸入**：僅開放查詢並由系統回填欄位之方式，不允許手動輸入。\
**分散運算**：指定Collector執行「Python」頁籤之代碼。

以下介紹子查詢的設定步驟：

1. **篩選**頁籤：在執行Python代碼前，先在此整理變數(簡稱：**元件變數**)，詳細可參考【應用管理＞篩選】章節。
2. **輸入**頁籤：設定那些「流程變數、元件變數」要帶入Python代碼，並以新的變數名稱提供Python代碼呼叫。
3. **套件**頁籤：填入Python代碼執行時需要先安裝的套件名稱，請確保OMFLOW可連線至PIPServer。
4. **Python**頁籤：在此編寫代碼，並將結果指向**result**變數，資料必須為二維陣列，格式如下：

```python

#將結果指向result變數

result = [
    ["Title1", "Title2"],
    ["row1"  , "row1"  ],
    ["row2"  , "row2"  ]
]

```

4. **回填**頁籤：當使用者選定資料後，會根據設定的欄位名稱〔Title〕將該筆資料的對應值回填至本表單的指定欄位中

#### 表單設計＞部門

下拉選單選擇已經建立的部門，可以設定複選。\
**預設值**頁籤：複選的預設值請以半形逗號分隔，範例：＜部門ID＞,＜部門ID＞,＜部門ID＞\
**選項**頁籤：限制哪些部門可以被選擇，或透過欄位計算規則與「使用者」欄位進行聯動。 1.2.1 New

#### 表單設計＞使用者

下拉選單選擇已經建立的使用者，可以設定複選。\
**預設值**頁籤：複選的預設值請以半形逗號分隔，範例：＜使用者ID＞,＜使用者ID＞,＜使用者ID＞\
**選項**頁籤：限制哪些部門可以被選擇，或透過欄位計算規則與「部門」欄位進行聯動。 1.2.1 New

#### 表單設計＞子表格

提供Table格式的欄位，用來收納多筆資料（簡稱：子表格資料）：

1. **行數**：Table預設顯示的行數高度
2. **必填**：勾選時，此欄位至少需要一筆**子表格資料**
3. **隱藏工具列**：隱藏「新增、資料移動、刪除」功能
4. **自訂表單**：並依照Table欄位設計一張子表單，以下幾點須注意；\
   • **必填**：當有一筆**子表格資料**被填寫時，相關的**必填**欄位也必須填寫。\
   • **欄位計算規則**：為同一筆**子表格資料**設定連動機制，詳細可參考【應用管理＞欄位計算規則】章節。\
   • **子表格欄位寬度**：子表格欄位預設為自適應頁面寬度，最小欄位寬度為150，也可啟用自訂功能填入固定寬度。1.2.1 New

> ※ 子表格的「子查詢、欄位計算規則」欄位可參考本表單欄位作為查詢條件。

#### 表單設計＞提示

提醒、警語用欄位，支援html格式

> ※ 該欄位內容僅作顯示使用，無法被使用者編輯也無法被流程使用。

#### 表單設計＞檔案上傳

提供上傳檔案的欄位，可進一步管控「檔案類型、數量、唯讀」等功能。

#### 表單設計＞※工作日誌

提供直接在表單上檢視「工作日誌」之功能，詳細可參考【Apps＞工作日誌】章節。

#### 表單設計＞※簽核

提供直接在表單上檢視「簽核紀錄」之功能，詳細可參考【應用管理＞簽核設計】及【簽核機制】章節。

> ※ 若流程設計了簽核功能，表單最上方也會自動顯示**簽核紀錄**欄位

### 表單設計＞欄位計算規則

為表單設定計算規則，當欄位值變更時同時變更其他欄位之設定或值。

> ※ 此規則只會在使用者填單時運作，流程中修改欄位值或進行欄位回填時不會觸發這些計算條件。

點擊**新增**按鈕即可新增規則(簡稱：運算規則)，每條運算規則最右側為「複製、設定、刪除」按鈕，其中點擊\*\*設定〔齒輪〕\*\*會跳出設定介面，以下介紹：

1. **設定**頁籤：進到設定畫面後，可以針對這條規則修改名稱以及新增註解。
2. **觸發欄位**頁籤：點擊新增來新增觸發欄位，當使用者填寫表單時，當觸發欄位的值被更動時，就會去檢查觸發條件。
3. **觸發條件**頁籤：當觸發條件達成時，才會開始進行運算。若觸發條件為空，則會直接進行運算。
4. **運算**頁籤：開始進行計算並將結果回填至指定欄位，分類如下：\
   **數字**：選擇表單欄位作為**變數**加入**運算內容**區塊，並使用數學符號進行運算。\
   **字串**：選擇表單欄位作為**變數**進行字串相加。\
   **日期**：選擇表單的「日期」欄位，並加減指定的時間長度。\
   **日期/時間**：選擇表單的「日期/時間」欄位，並加減指定的時間長度。\
   **日期/指定時間**：選擇表單的「日期/時間」欄位，並加減指定的日期長度，再重新指定時間。\
   **資料查詢**：類似子查詢設定，將查詢到的表單資料的對應欄位值回填至本表單欄位。\
   **欄位聯動**：修改本表單的欄位設定，如唯讀、必填、選項等設定。

## 流程設計

```
位置：［主選單］＞應用管理＞應用設計＞［任一應用］＞［任一流程］＞流程設計
```

當新增的表單為「表單流程」時，可點擊**流程設計**頁籤進入流程設計介面，進入後會看到一個預設的流程，其中大部分的元件被有箭頭的連線串接形成一張流程圖，流程在開單後會依序執行此處的設計，以下先簡單介紹元件基本操作：

點擊「人工輸入」元件會在該元件周圍顯示功能按鈕，以下介紹：

1. 拖拉：滑鼠左鍵按住此元件並移動即可在流程圖上拖曳位置
2. 設定：點擊後跳出相關設定介面，詳細可參考【流程各元件介紹】章節
3. 複製：複製這個元件（包含設定完的參數）
4. 刪除：刪除這個元件（包含元件連接出去的線）
5. 連接點：連接其他元件，連接方式可參考【建立應用及流程＞建立連結】章節

### 流程各元件介紹

點擊主畫面左上方\*\*+新增\*\*按鈕即可在流程圖上加入指定元件，以下介紹各元件：

#### 元件 - 開始

一個流程的源頭，建議在此建立流程變數以供後續元件使用，以下介紹各頁籤用途：

1. **設定**頁籤：設定此元件一般屬性，其中「顯示名稱」能修改元件的顯示名字，方便使用者檢視流程時辨識當前位置，勾選**資料驗證**則會開啟驗證功能。
2. **輸入**頁籤：將欄位值或是固定字串寫入變數中，在此建立的變數為**流程變數**，後續所有的元件都可以使用這些變數。這裡會看到有一個預設的輸入，result=success，其變數在OMFLOW有許多功能，一般多用於宣告此單是否正常執行完畢。

> ※ 此處設計的變數可作為**資料驗證**代碼運行的輸入變數，也可在**資料驗證**輸出時將資料由該變數承接，以供後續流程使用。 1.2.1 New

3. **資料驗證**頁籤：在**設定**頁籤勾選**資料驗證**時會出現此頁籤，可編寫Python代碼檢查其表單內容，並由status變數判斷是否允許開立此表單，詳細可參考【應用管理＞程式碼元件】章節。

#### 元件 - 結束

一個流程的結束，只有當流程進行到此元件時，才會進行**關單**動作（關閉任務、結束SLA監控...等），當流程被其他流程所呼叫時，也只有進行到「結束」元件時會回傳執行結果。

> ※ 一般情況下，應讓流程順利執行至「結束」元件。

當流程屬於下列幾種情況時請務必連接至「結束」元件，否則流程會無法順利完成：\
• 當流程為子流程時\
• 當流程會被其他流程呼叫時\
• 當流程為資料收集流程時

**篩選**頁籤：此處能整理準備輸出的「流程變數、表單欄位、系統參數、應用參數」參數，方便後續的流程介接或資料回傳回主流程或OMFLOW Server，其中**系統參數**可參考【應用管理＞參數管理】章節。

> ※ 篩選所建立的變數，只有當前元件能使用，並非流程變數。

#### 元件 - 人工輸入

一旦流程執行到這裡，會停下來讓使用者檢閱、填寫資料並推進（可透過前端介面或是API推進）。

> ※ 進入人工輸入時，只有**手動推單**或**API推單**才能使流程繼續前進。

**「設定」頁籤**

1. **紀錄Log**：與介紹過的\*\*執行過程記錄(LOG)\*\*作用相同，差別在於此功能只會影響到當前元件。
2. **顯示送出按鈕**：此選項決定當快速操作啟用時，使用者進入表單後除了快速操作的按鈕，是否還需要顯示送出按鈕。
3. **啟用簽核功能**：啟用簽核功能後，會多出簽核頁籤，使用者在表單中所見的送出按鈕會改為送簽按鈕。簽核完成後無論同意與否皆會進行後續流程。
4. **指定送簽人**：此功能須先啟用簽核。啟用後若未指定送簽人，則推單人就是送簽人。
5. **直接送簽**：此功能須先啟用簽核。此功能啟用後進入該人工處理時，並不會停留，會直接進入簽核，此時若上方的指定送簽人未指定時，送簽人為受派人，若無受派人則送簽人為System。

**「篩選」頁籤**

此處能整理「流程變數、表單欄位、系統參數、應用參數」參數，以提供此元件後續的頁籤取用。

> ※ 篩選所建立的變數，只有當前元件能使用，並非流程變數。

**「欄位設定」頁籤**

在流程停下來時，修改資料庫中的欄位值，當使用者開啟表單後，會顯示已經被修改的內容。

**「自訂表單」頁籤**

可選擇是否載入表單設計所設計的表單。選擇載入後，可以針對當前呈現的表單進行修改——刪除或新增一些欄位成符合當下所需呈現給使用者的內容。若不選擇載入，則會直接套用表單設計的表單。

**「資料驗證」頁籤**

在**設定**頁籤勾選**資料驗證**時會出現此頁籤，可編寫Python代碼檢查其表單內容，並由status變數判斷是否允許推單，詳細可參考【應用管理＞程式碼元件】章節。

> ※ 資料驗證時，若status為error，則message會作為錯誤訊息顯示於介面。

**「簽核」頁籤**

點擊**新增**按鈕來新增簽核模板，簽核模板可進行下列設定：

1. **簽核名稱**：選擇一個現有的簽核模板。
2. **允許使用者自行調整**：當設定為允許時，使用者點選送簽之後會跳出該簽核模板的階段設定，使用者可額外新增階段，但是無法刪除原有階段。
3. **條件**：當有多個簽核模板時，設定條件後，使用者按下送簽，會依照條件決定執行哪個簽核模板，如果有兩個以上的條件符合時，使用者的畫面會彈出符合的簽核模板，由使用者自行決定要執行哪個簽核模板。
4. **簽核設定**：

> **輸入**：從流程輸入變數到簽核中。
>
> **階段**：此處的階段頁籤僅供設計人員了解該簽核模板進行了哪些階段。若該設計超過兩個階段時，才會有下列的條件可以進行設定。
>
> **條件**：設定條件來決定該次簽核是否走後續階段。假設有三個階段，若第二階段的條件不符合時，第二以及第三階段都不會執行，也就是第一階段的結果即為此次簽核的最終結果。

**「輸出」頁籤**

類似於「開始」元件的輸入，將使用者更新的欄位內容輸出成流程變數，以供後續元件使用。

**「動作1、動作2」頁籤**

又稱為快速操作，設計完成後可在**我的任務＞任務列表**上使用，讓使用者在不觀看表單內容的前提直接推單，使用時會依照該處的設計修改欄位值並推進流程。許多固定式的回覆、推進可透過該功能完成。

#### 元件 - 欄位設定

將變數或是固定字串填入資料庫中。當需要修改資料庫且不需經過人工處理時可選擇該元件。

#### 元件 - 欄位/變數篩選

將變數或是欄位進行簡單的置換或是取得系統參數與預設欄位，再輸出給其他流程元件使用。

#### 元件 - 呼叫流程

呼叫一個同應用底下的其他流程，當該流程進入結束時，本流程才會進續前進。

1. **異常時通過**：當流程執行到該元件發生錯誤時，是否忽略錯誤使流程繼續往下進行。
2. **流程**：選擇要開單的主流程。
3. **流程輸入**：選擇主流程後，會將該流程的表單欄位以及「開始」元件的輸入帶入此頁籤，**若是沒有輸入任何值，系統默認為輸入空字串。**
4. **流程輸出**：選擇流程後，會將該流程的「結束」元件輸出帶入此頁籤。選擇需要的輸出放入當前流程的流程變數中，以供後續元件使用。

#### 元件 - 子流程

呼叫當前主流程的子流程，當該流程進入「結束」元件時，本流程才會進續前進，其餘部分【應用管理＞呼叫流程】基本一致。

1. **子流程**：選擇要執行的子流程。
2. **子流程輸入**：選擇子流程後，會將該流程的表單欄位以及「開始」元件的輸入帶入此頁籤，**若是沒有輸入任何值，系統默認為輸入空字串。**
3. **子流程輸出**：選擇子流程後，會將該流程的「結束」元件輸出帶入此頁籤。選擇需要的輸出放入當前流程的流程變數中，以供後續元件使用。

#### 元件 - 程式碼

撰寫一段Python代碼讓資料中心/收集器執行，以下將針對各頁籤介紹：

**「設定」頁籤**

1. **顯示名稱**：給予該元件一個名稱，方便使用者檢視流程時辨識當前位置。
2. **異常時通過**：當流程執行到該元件發生錯誤時，是否忽略錯誤使流程繼續往下進行。
3. **分散運算**：勾選此選項時，伺服器會將程式碼指派至「分散運算」群組，並隨機指派一台Collector執行，詳細可參考【資料收集＞收集器管理】章節。
4. **紀錄Log**：與介紹過的\*\*執行過程記錄(LOG)\*\*作用相同，差別在於此功能只會影響到當前元件。

**「篩選」頁籤**

**篩選**頁籤：此處能整理準備輸出的「流程變數、表單欄位、系統參數、應用參數」參數，方便後續的Python代碼取用，其中**系統參數**可參考【應用管理＞參數管理】章節。

> ※ 篩選所建立的變數，只有當前元件能使用，並非流程變數。

**「輸入」頁籤**

輸入「變數、字串、欄位值」至Python代碼中，下面範例介紹如何使用：

假設python頁籤中所打的程式碼如下：

```
d = a + b + c
```

此時需要將 a 、b、c、d 四個變數帶入，設定如下：

| 輸入變數 | 變數名稱 | 說明            |
| ---- | ---- | ------------- |
| 1    | a    | 將固定字串指向a      |
| 欄位B  | b    | 將特定欄位值指向b     |
| 變數C  | c    | 將元件變數或流程變數指向c |
|      | d    | 建立一個空變數       |

> 注意要點：\
> • 將「d」帶入是為了能夠將其帶回流程。\
> • 所有帶入的參數都是字串，因此需要在程式碼中自行轉換成所需的資料型態。

**「套件」頁籤**

當python中有需要額外的套件，將套件名稱輸入在此。系統上架流程時會進行判斷是否已經有此套件，若是沒有套件會從網路下載並安裝。

> ※ 如果沒有對外網路，可以自行架設pypi repository server，並修改系統設定。

**「Python」頁籤**

撰寫所需的python程式碼。程式碼最終結果的回傳不是依靠return，而是需要在最外層撰寫一個輸入頁籤的變數來接住結果，代碼如下：

```
d = a + b + c
```

> ※ 從**輸入頁籤**設定的變數無須在代碼中宣告即可呼叫。

**「輸出」頁籤**

取得python執行結果(d)，並寫回流程變數，。

| 輸入資料 | 變數名稱        | 說明                |
| ---- | ----------- | ----------------- |
| d    | calculation | 新增流程變數calculation |

> ※ 只有經過輸入頁籤的變數才可在此進行輸出！

#### 元件 - 外部流程

呼叫已上架應用的流程，當該流程進入「結束」元件時，本流程才會進續前進。

1. **外部流程**：選擇要開單執行的外部流程。
2. **流程輸入**：選擇流程後，會將該流程的表單欄位以及「開始」元件的輸入帶入此頁籤，**若是沒有輸入任何值，系統默認為輸入空字串。**
3. **流程輸出**：選擇流程後，會將該流程的「結束」元件輸出帶入此頁籤。選擇需要的輸出放入當前流程的流程變數中，以供後續元件使用。

#### 元件 - 條件判斷

此元件可設計分支路線，並依照條件決定前進的路線，並有以下注意：

> 注意要點：\
> (1) 規則會在拉線之後顯示\
> (2) 規則顯示的"FITEM-?"會呈現在各元件畫面的左上角\
> (3) 當有兩條規則成立時會走下面那條路線\
> (4) 刪除線重建時，需要重新定義規則

#### 元件 - 簽核判斷

此元件根據簽核的最終結果決定前進「同意、否決」兩條路線，並有以下注意：

> 注意要點：\
> (1) 規則的選項會在拉線之後顯示。\
> (2) 規則顯示的"FITEM-?"會呈現在各元件畫面的左上角。\
> (3) 此規則元件只能判斷最終簽核結果是同意與否，因此拉第三條線沒有意義。

#### 元件 - 並行

與「條件判斷」元件不同，並行元件會同時進行每條分支路線。

> ※ **在並行後所產生的流程變數，其他分支是無法共用的。**

#### 元件 - 並行匯集

可以將並行出去的分支匯集於此元件，並選擇其中一條分之為主線，如果沒有進行勾選主線則會以最後完成的支線作為主線。同時所有分支的流程變數皆會被收納，若有同名變數則以主線為主。

> ※ **如果設計了匯集元件，必須等所有連接至匯集元件的分支都完成後，才會繼續進行後面流程。**

#### 元件 - 動態並行

讓流程能對於同路線同時進行多次作業且互不影響。

> ※ **在動態並行後所產生的流程變數，其他分支是無法共用的。**

1. **並行數量**：給予一個欄位或變數或固定值來決定並行次數：\
   • **陣列**：可選擇格式為陣列的「變數、欄位」或直接輸入值(範例：A,B,C,D)，並根據該陣列長度計算並行次數(範例：4次)\
   • **數值**：直接填入格式為數字的「變數、欄位」或直接輸入值(範例：3)決定並行次數(範例：3次)

2 **陣列輸入**：建立新的流程變數，並為不同分支賦予不同的值\
• **輸入資料**：可選擇格式為陣列的「變數、欄位」或直接輸入值，範例：A,B,C,D，則第一條分支會得到「A」\
• **變數名稱**：輸入文字，作為輸入資料的流程變數名稱。

#### 元件 - 動態匯集

可以將動態並行出去的分支收納回來，最後一條完成的分支為主線，若有變數需要**合併**則須在輸出頁籤進行設定，否則以主線為主。

> ※ **當所有分支都完成後，才會繼續進行後面流程。**

1. **輸出json格式**：將輸出頁籤的資料改為字串型態的json格式。
2. **置換","字元**：將輸出頁籤的變數值或欄位值的“,”(半形逗號)，替換成其他字元。
3. **輸出**頁籤：選擇所有分支的共同欄位或變數進行合併，並輸出成另一個變數。

```
輸出範例如下：\

線路一： "A"\
線路二："B,D"\
線路三："X，Y"

合併變數輸出為："A,B,D,X，Y"\
若在設定頁籤勾選轉換成json，則輸出為："\['A', 'B,D', 'X，Y']"\
若在設定頁籤勾選置換","成"ooo"，則輸出為："A,BoooD,X，Y"
```

#### 元件 - 暫停

使流程暫停指定毫秒才繼續前進，相關設定如下：\
• **輸入**：帶入一個數字變數。\
• **預設值**：若是輸入為空時，取預設值。

#### 元件 - 同系職務/權責

該元件與「部門、組織圖、職務管理」連動，可從**特定使用者**的**預設部門**往**上**查找指定的**職務**負責人，並回傳該負責人的相關資訊：

**「輸入」頁籤**

設定如下：

1. **職務代號**：選擇使用職務代號(position\_no)還是權責名稱(responsibilitie\_name)進行查詢，並輸入對應值。
2. **使用者編號**：填入使用者編號，通常是申請人的使用者ID。
3. **查詢方式**：選擇透過組織圖或是部門架構來查詢，詳細可參考【人員管理＞部門管理】及【人員管理＞組織圖】及【簽核機制】章節。
4. **組織圖名稱**：如果選擇組織圖來進行查詢，填入一個組織圖名稱，詳細可參考【人員管理＞組織圖】章節。
5. **組織圖座標**：如果選擇組織圖來進行查詢，第一次查詢時不用填入組織圖座標，第二次後的查詢如果要延續第一次查詢結果往下一階繼續查，那麼可以填入第一次查詢後輸出的組織圖座標來進行定位，避免使用者在同一張圖中有兩個部門導致查錯對象。

**「輸出」頁籤**

設定如下：

1. **部門編號(ID)**：若找到相符**職務/權責**的使用者，則回傳該使用者的預設部門ID
2. **使用者編號**：若找到相符**職務/權責**的使用者，則回傳該使用者ID
3. **組織圖座標**：若找到相符**職務/權責**的使用者，則回傳該職務的所屬部門代號，當需要「以此座標為下一次查詢的出發點」時可使用

#### 元件 - 部門職務/權責

該元件與「部門、組織圖、職務管理」連動，可從**特定部門**往**下**查找指定的**職務**負責人，並回傳該負責人的相關資訊：

**「輸入」頁籤**

設定如下：

1. **部門代號**：填入部門編號(dept\_no)或部門代號(dept\_code)作為要查找的出發點。
2. **職務代號**：選擇使用職務代號(position\_no)還是權責名稱(responsibilitie\_name)進行查詢，並輸入對應值。
3. **查詢方式**：選擇透過組織圖或是部門架構來查詢，詳細可參考【人員管理＞部門管理】及【人員管理＞組織圖】及【簽核機制】章節。
4. **組織圖名稱**：如果選擇組織圖來進行查詢，填入一個組織圖名稱，詳細可參考【人員管理＞組織圖】章節。

**「輸出」頁籤**

設定如下：

1. **部門編號(ID)**：若找到相符**職務/權責**的使用者，則回傳該使用者的預設部門ID
2. **使用者編號**：若找到相符**職務/權責**的使用者，則回傳該使用者ID
3. **組織圖座標**：若找到相符**職務/權責**的使用者，則回傳該職務的所屬部門代號，當需要「以此座標為下一次查詢的出發點」時可使用

## 子流程設計

進入子流程頁籤會看到子流程列表，子流程主要特性如下：\
• 簡化並提高主流程可讀性\
• 只能被主流程呼叫\
• 子流程的元件類別與主流程相同，請參考上面介紹

> ※ 子流程編輯完成時，請點擊主畫面右上角之「確定」按鈕以確定修改，並按下「儲存」按鈕進行最後儲存。

## 已上架應用

```
位置：［主選單］＞應用管理＞已上架應用
```

管理已上架應用的介面。

### 已上架應用列表

當應用上架時，各項應用會顯示於此，並有以下功能介紹：

1. **下架**：下架一個已上架的應用。
2. **篩選**：透過關鍵字搜尋、一次顯示資料筆數。
3. **還原**：將篩選還原成預設值。
4. **匯出**：將勾選的應用匯出，可以在應用設計進行匯入。
5. \*\*修改：\*\*修改該版本應用的備註。
6. **紀錄**：點擊之後，會顯示所有曾經上架過的應用(包含所有版本)。

### 已上架流程列表

```
位置：［主選單］＞應用管理＞已上架應用＞［任一應用］
```

點擊應用列表之後，會跳轉至該應用的流程列表，流程列表功能介紹：

1. **啟用**：勾選流程後批次啟用。
2. **停用**：勾選流程後批次停用。當流程停用時，正在進行中的任務會中斷，且無法再次對該流程開單或推進。
3. **篩選**：透過關鍵字搜尋、一次顯示資料筆數。
4. **還原**：將篩選還原成預設值。

列表上的狀態、LOG、API欄位以及最後的設定，都是可以點擊的按鍵：

1. **狀態**：點擊之後會切換啟用與停用，效果跟上方列表的啟用停用相同。
2. **LOG**：開啟或關閉**執行過程記錄**功能，此處能不重新上架應用直接動態修改。
3. **API**：開啟或關閉**應用程式介面**功能，此處能不重新上架應用直接動態修改。
4. **設定**：分為欄位設定與API，介紹如下：

> **欄位設定**：修改列表所顯示的欄位。\
> **開單API**：內容含API、Method、postbody範例與回傳範例。\
> **查詢API**：內容含API、Method、postbody範例與回傳範例。\
> **推單API**：內容含API、Method、postbody範例與回傳範例。

注意要點：

> ※ 此處的**查詢API**並非查詢該流程有哪些單號，而是針對特定單號查詢其停留在人工點的資料編號，因為流程設計可能會設計並行、動態並行等，因此同一張單可能同時產生多筆資料停在人工處理等待推進，此時便需要查詢其資料編號來進行推進。

### 流程表單列表

點擊流程後可以進入表單列表，每次開單都會在此列表產生一筆資料。當表單執行完畢後，會呈現灰色狀態，若未執行完畢或是產生錯誤時，資料的最後面會出現編輯的選項可以點擊。點擊**編輯**按鈕後，會出現該張單當前的輸入與輸出，此時可以手動修改參數，修改完畢後點擊確定來推進流程。

> ※ 此處可針對執行**錯誤**的表單進行**重新推單**。

## 排程設定

```
位置：［主選單］＞應用管理＞排程設定
```

針對已上架的流程，可建立排程使其定期開單。

### 新建排程

進入排程列表頁面後，點擊新增按鈕即可建立新排程，步驟如下：

1. 選擇一個已經上架的流程，如果該流程有設計表單，流程名稱後方會多出一個**表單內容**的按鈕。
2. 點擊**表單內容**按鈕，會顯示這個流程所設計的表單，填寫完畢後再點擊**排程**按鈕。
3. 設定排程週期，按下**確定**按鈕後便會依照設定進行開單。

### 編輯排程

已建立的排程會出現在排程列表中，狀態欄位下方同樣有「啟用、停用」的按鍵可以快速操作，點擊列表最後的**編輯**按鈕可以修改排程。

## 參數管理

參數用於流程當中，流程可以在某些元件的篩選頁籤中，取得參數來使用，參數同樣可以進行批次匯入與匯出，相關設定如下：

1. **名稱**：參數名稱
2. **說明**：參數的說明
3. **參數值**：參數的值
4. **遮罩**：選擇為是時，參數值在列表中會顯示成 ⋯⋯

> ※ 當許多流程需要用到同一參數值時建議使用此功能，如伺服器 IP。

## 服務水準管理

```
位置：［主選單］＞應用管理＞服務水準管理
```

服務水準規則用來監控指定的流程，當開單或推單時，欄位內容變化觸發了服務水準，此時會根據觸發條件去修改該單的燈號、開立事件，同時發信通知指定人員。

### 數值測量

選擇一個已上架的流程後，選定一個欄位，當欄位符合提醒規則時，會發提醒通知，並且將單的燈號改為黃燈，如果符合違反規則，會發違反通知，且將單的燈號改為紅燈。

當特定欄位的值符合條件時變更**服務水準燈號**，設定介紹如下：

1. **通知主旨**：寄信用的主旨。
2. **通知內容**：寄信用的內文。
3. **通知角色**：可選擇多個角色，這些角色的使用者都會被通知。
4. **通知人**：可選擇多位使用者，這些使用者都會被通知。
5. **通知開單人**：通知該單的開單人。
6. **應用名稱**：選擇要監控的應用
7. **流程名稱**：選擇要監控的流程
8. **提醒規則**：當監控欄位符合設定值時，將發送信件通知並將服務水準燈號改為黃燈
9. **違反規則**：當監控欄位符合設定值時，將發送信件通知並將服務水準燈號改為紅燈

> ※ **進階觸發條件**按鈕可追加觸發條件，需同時滿足「提醒規則、違反規則」才會變更服務水準燈號。

### 時間測量

時間測量與數值測量不同，這裡多了觸發條件與終止條件，達成觸發條件時，會開始計時，達成終止條件時，會結束計時。計時超出提醒規則時，修改燈號、建立事件單、發信通知，超出違反時同樣做上述動作。

1. **如果不設計觸發條件，則代表開單即觸發。**
2. **如果不設計終止條件，則代表關單才終止。**

## 簽核管理

```
位置：［主選單］＞應用管理＞簽核管理
```

### 簽核列表

顯示已經建立的簽核模板。

1. **新增**：新增簽核模板。
2. **刪除**：刪除簽核模板。

### 新增簽核

點下新增簽核後，會彈出建立的畫面，下面依序介紹畫面上方的幾個頁籤。

#### 「設定」頁籤

設定如下：

1. **名稱**：簽核模板名稱。
2. **說明**：該模板的說明，提供給流程設計者參考。
3. **通知簽核人**：當簽核派給簽核人時，該使用者是否收到通知。
4. **通知送簽人**：當簽核派給新的簽核人時，送簽人是否收到通知。
5. **通知方式**：分成系統通知以及電子郵件。電子郵件會依照**應用設計>參數管理**中的郵件伺服器設定進行發送。
6. **通知內文格式**：可選擇通知內容格式為純文字或html。

#### 「輸入」頁籤

設定如下：

1. **內建參數**：系統提供的內建參數，此參數會依據當前簽核的各項設定、階段來變更。
2. **輸入變數**：從流程中數入變數以提供後續簽核使用。

#### 「階段」頁籤

點擊新增可以新增階段，下面介紹階段的各項設定：

1. **名稱**：階段名稱，主要用來顯示在簽核紀錄中。
2. **說明**：階段說明。
3. **允許快速操作**：決定該筆簽核是否允許使用者在我的任務中進行快速操作。
4. **允許加簽**：決定該筆簽核是否允許加簽。加簽後使用者的權重會移交給加簽的對象。
5. **多人會簽**：啟用多人簽核後，會多出簽核結果判斷相關的項目，且下方的簽核主管也會多出新增按鈕來新增多位主管。\
   (1) **全體同意**：全部簽核主管同意才會進行下個階段，當有一人否決時，則離開簽核並輸出此次簽核結果為不同意。\
   (2) **權重門檻**：依照門檻設定來決定此階段之結果。

> * 達到門檻視為：此處先區分同意或不同意，達成條件則為所選結果，反之則為另一選項。下方數字區域填入門檻分數，預設為100。
> * 自訂權重：勾選後下方簽核主管的權重可自行輸入數字，若未勾選則會依照簽核主管人數來平均分配數字（100分來進行平分）。
> * 簽核權重達到門檻即結束當前階段：此項目勾選後，當部分主管簽核後所加權的分數達到簽核門檻時，則會關閉其他簽核主管的簽核單，並依照設定的結果推進至下一階段或離開簽核。

(3) **權重比較**：所有簽核主管都簽核完成後，依照各自的加權分數來進行加總，分數高的一方為推進結果。

> * 簽核結果權重相等時：選擇當雙方權重相同時，依照何種結果進行輸出。
> * 自訂權重：勾選後下方簽核主管的權重可自行輸入數字，若未勾選則會依照簽核主管人數來平均分配數字（100分來進行平分）。

6. 簽核主管：\
   (1) **權重**：未啟用上方多人會簽時，此選項不可更動。啟用多人會簽後會依照其設定來決定可否調整。\
   (2) **名稱**：簽核主管名稱，主要用來顯示在簽核紀錄中。\
   (3) **類型**：簽核主管有下列四種查詢方式。

> * 指定人：直接指定該筆簽核由哪位使用者進行批審。
> * 組織圖查詢：透過組織圖進行查詢。
> * 部門查詢：透過部門架構進行查詢。
> * 外部查詢（Python）：呼叫其他系統或系統內其他流程來查詢。

(4) 簽核人：

> * 組織圖名稱：類型選擇組織圖查詢時才會啟用此選單，用來輸入組織圖名稱。
> * 查詢方式：類型選擇組織圖查詢、部門查詢時才會啟用此選單，選擇同系職務/同系權責/部門職務/部門權責其中一項來進行查詢。
> * 選擇部門／職務名稱／權責名稱：此選單會依據類型的不同而有所改變。當類型是指定人時，此選單為選擇部門；當類型是組織圖查詢或部門查詢時，此選單會依據查詢方式顯示為職務名稱或權責名稱。
> * 選擇使用者／使用者編號／部門代號：此選單會依據類型的不同而有所改變。當類型是指定人時，此選單為選擇使用者；當類型是組織圖查詢或部門查詢時，此選單會依據查詢方式顯示為使用者編號或部門代號。

#### 「通知」頁籤

此頁籤在發送信件通知時，設計對應的主旨及內容：

1. **主旨**：通知主旨。可使用內建參數與變數，使用方法可將滑鼠移至主旨旁的問號上，靜待兩秒則會顯示。
2. **內文**：通知內文。同樣可使用內建參數與變數，使用方法同主旨。

#### 「Python」頁籤

此頁籤僅用來對簽核主管查詢時使用，當簽核主管的查詢方式選擇外部查詢（Python）時，則會呼叫此程式碼進行查詢。

1. **新增**：此新增用來新增程式碼中會使用到的python套件，該模板儲存時會進行套件的檢查。
2. **程式碼**：自行輸入需呼叫的程式碼，回傳與範例已寫在上面。此處可以使用內建參數與變數，使用方法類似通知，只是不需要用大括弧{}來包變數。
